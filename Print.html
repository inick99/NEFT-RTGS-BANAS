<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RTGS/NEFT/IMPS Transaction Request Form - Print</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
  <style>
    body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
  font-size: 12px;
  line-height: 1.4;
  color: #000;
}

.container {
  padding: 10mm;
  width: 190mm;
  margin: 0 auto;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin: 8px 0;
}

th, td {
  border: 1px solid #000;
  padding: 3px 4px;
  text-align: left;
  vertical-align: top;
}

th {
  background: #fff;
  font-weight: bold;
}

h1, h2, h3 {
  text-align: center;
  margin: 6px 0;
  color: #000;
}

h1 { font-size: 16px; }
h2 { font-size: 14px; }
h3 { font-size: 12px; border-bottom: 1px solid #000; padding-bottom: 3px; }

.signature-line {
  border-bottom: 1px solid black;
  height: 60px;
}

.footer {
  border-top: 1px dashed #000;
  padding-top: 5px;
  font-size: 11px;
  text-align: center;
  margin-top: 10px;
}

.print-buttons {
  text-align: center;
  margin: 20px 0;
}

@media print {
  body {
    margin: 0;
    padding: 0;
    font-size: 11px;
  }

  .container {
    width: auto;
    margin: 0;
    padding: 10mm;
  }

  .print-buttons {
    display: none !important;
  }

  @page {
    size: A4 portrait;
    margin: 10mm;
  }
}
  </style>
</head>
<body>
  <div class="container">
    <p style="text-align: center; margin: 0; padding: 0;"><strong>The Banaskantha Dist. Central Co-operative Bank Ltd. Palanpur</strong></p>
    <p style="text-align: center; margin: 0; padding: 0;">RTGS/NEFT/IMPS Transaction Request Form</p>
    <hr style=" margin: 0; padding: 0;">
    <table style="width: 100%; border: none; border-collapse: collapse;">
      <tr>
        <td style="padding: 0px; width: 60%; border: none;">
          <strong>To,</strong><br />
          The Banaskantha Dist. Central Co-operative Bank Ltd.
        </td>
        <td style="padding: 0px; width: 40%; border: none; text-align: right;">
          <strong>Branch:</strong> <span id="senderBranchPrint"></span><br />
          <strong>Date:</strong> <span id="currentDate"></span>
        </td>
      </tr>
    </table>
    <p style=" margin: 0; padding: 0;">Please remit a sum of <strong>₹ <span id="amountPrint"></span> (<span id="amountWordsPrint"></span>)</strong> via <strong><span id="transactionTypePrint"></span></strong> as per details given below and debit the amount to my/our account.</p>
    <table>
      <tr>
        <th colspan="2" class="text-center">Beneficiary Details</th>
      </tr>
      <tr>
        <td>Beneficiary Name</td>
        <td id="payeeNamePrint"></td>
      </tr>
      <tr>
        <td>Beneficiary Account Number</td>
        <td id="beneficiaryAccountPrint"></td>
      </tr>
      <tr>
        <td>Beneficiary Account Number (Again)</td>
        <td id="beneficiaryAccountConfirmPrint"></td>
      </tr>
      <tr>
        <td>Beneficiary Bank Name & Branch</td>
        <td><span id="bankNamePrint"></span>, <span id="branchNamePrint"></span></td>
      </tr>
      <tr>
        <td>Beneficiary Bank IFSC Code</td>
        <td id="ifsCodePrint"></td>
      </tr>
      <tr>
        <td>Details / Purpose of Transfer</td>
        <td id="messagePrint"></td>
      </tr>
    </table>
    <br style=" margin: 0; padding: 0;">
    <table>
      <tr>
        <th colspan="2" class="text-center">My / Our Details (Remitter)</th>
      </tr>
      <tr>
        <td>Remitter (Applicant) Name</td>
        <td id="accountHolderPrint"></td>
      </tr>
      <tr>
        <td>Remitter Account Number & Type</td>
        <td>A/C No. <span id="senderAccountPrint"></span> | A/C Type: <span id="senderAccountTypePrint"></span></td>
      </tr>
      <tr>
        <td>Mobile Number of Remitter (Mandatory)</td>
        <td id="mobilenumberPrint"></td>
      </tr>
    </table>
    <p style=" margin: 0; padding: 0;"><strong>Terms & Conditions</strong></p>
    <p style="text-align: justify; margin: 0; padding: 0;"><strong>1.</strong> The B.K. Dist. Co-op. Bank Ltd. shall not be responsible for any delay in processing payments due to the RBI, RTGS/NEFT/IMPS system not being available, failure of internal communication systems at the recipient bank/branch, incorrect information provided by the remitter, or any incorrect credit accorded by the recipient bank/branch due to incorrect information provided by the remitter.</p>
    <p style="text-align: justify; margin: 0; padding: 0;"><strong>2.</strong> It is the responsibility of the RTGS/NEFT/IMPS customer to ensure the genuineness of the transactions conducted through RTGS/NEFT/IMPS and to ensure that no illegal transactions are conducted through these systems. The B.K. Dist. Co-op. Bank Ltd. shall not assume any liability to anyone solely because such transactions are routed through the bank.</p>
    <p style="text-align: justify; margin: 0; padding: 0;"><strong>3.</strong> I/We hereby agree and understand that the RTGS/NEFT/IMPS request is subject to the RBI regulations and guidelines governing the same.</p>
    <p style="text-align: justify; margin: 0; padding: 0;"><strong>4.</strong> If there is a holiday or closure at the center where the recipient branch is situated, the credit will be passed on to the beneficiary account on the next working day.</p>
    <p style="text-align: justify; margin: 0; padding: 0;"><strong>5.</strong> The RTGS/NEFT/IMPS customer hereby agrees and undertakes that he/she is aware of all the RTGS/NEFT/IMPS rules set by the RBI and will abide by all guidelines issued by the RBI or any other regulatory authorities, or as communicated by The B.K. Dist. Co-op. Bank Ltd., applicable to transactions related to RTGS/NEFT/IMPS, whether directly or indirectly.</p>
    <p style="text-align: justify; margin: 0; padding: 0;"><strong>6.</strong> These provisions shall always be subject to any rules, terms, conditions, and administrative guidelines issued by the RBI, which may be enforced from time to time in respect of the operation of RTGS/NEFT/IMPS accounts.</p>
    <p style="text-align: justify; margin: 0; padding: 0;"><strong>•</strong> The RTGS/NEFT/IMPS customer hereby agrees and undertakes to indemnify and keep indemnified The B.K. Dist. Co-op. Bank Ltd. from time to time against all losses, damages, costs (including legal fees), penalties, and consequences arising in connection with maintaining the said RTGS/NEFT/IMPS accounts or by virtue of The B.K. Dist. Co-op. Bank Ltd. acting for and on behalf of the RTGS/NEFT/IMPS customer in pursuance of this agreement.</p>

    <table>
      <tr>
        <th colspan="3" class="text-center">Signatures</th>
      </tr>
      <tr>
        <td style="border-bottom: none;">1st Signatory:</td>
        <td style="border-bottom: none;">2nd Signatory:</td>
        <td style="border-bottom: none;">3rd Signatory:</td>
      </tr>
      <tr>
        <td class="signature-line"></td>
        <td class="signature-line"></td>
        <td class="signature-line"></td>
      </tr>
    </table>

    <div class="footer">
      <p><strong>Customer Acknowledgement Slip</strong></p>
      <p>Received Transaction Request from <span id="senderBranchAck"></span> A/C No. <span id="senderAccountAck"></span> for <span id="transactionTypeAck"></span> in the sum of ₹ <span id="amountAck"></span> to be credited to Account Number <span id="beneficiaryAccountAck"></span>, <span id="bankNameAck"></span>, IFSC Code <span id="ifsCodeAck"></span>, Beneficiary Name <span id="payeeNameAck"></span>.</p>
      <p>Signature: ___________________ | E Code: ___________________</p>
    </div>
  </div>

  <div class="print-buttons">
    <button type="button" class="btn btn-success btn-lg" onclick="exportPdf()">Export as PDF</button>
    <button type="button" class="btn btn-info btn-lg ms-3" onclick="window.print()">Print This Page</button>
  </div>

  <!-- Load PDF generation libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <script src="en-IN.js"></script>
  <script src="ToWords.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Get URL parameters
      const urlParams = new URLSearchParams(window.location.search);

      // Function to set text content of an element by ID
      function setElementText(id, value) {
        const element = document.getElementById(id);
        if (element) {
          element.innerText = value;
        }
      }

      // Populate Remitter Details
      setElementText('transactionTypePrint', urlParams.get('transactionType') || 'N/A');
      setElementText('senderAccountPrint', urlParams.get('senderAccount') || 'N/A');
      setElementText('accountHolderPrint', urlParams.get('accountHolder') || 'N/A');
      setElementText('mobilenumberPrint', urlParams.get('mobilenumber') || 'N/A');
      setElementText('senderBranchPrint', urlParams.get('senderBranch') || 'N/A');
      setElementText('senderAccountTypePrint', urlParams.get('senderAccountType') || 'N/A');

      // Populate Beneficiary Details
      setElementText('payeeNamePrint', urlParams.get('payeeName') || 'N/A');
      setElementText('bankNamePrint', urlParams.get('bankName') || 'N/A');
      setElementText('branchNamePrint', urlParams.get('branchName') || 'N/A');
      setElementText('ifsCodePrint', urlParams.get('ifsCode') || 'N/A');
      setElementText('beneficiaryAccountPrint', urlParams.get('beneficiaryAccount') || 'N/A');
      setElementText('beneficiaryAccountConfirmPrint', urlParams.get('beneficiaryAccountConfirm') || 'N/A');
      setElementText('accountTypePrint', urlParams.get('accountType') || 'N/A');
      setElementText('messagePrint', urlParams.get('message') || 'N/A');

      // Handle Amount and convert to words
      const amount = parseFloat(urlParams.get('amount'));
      if (!isNaN(amount)) {
        const formattedAmount = amount.toLocaleString('en-IN', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });
        setElementText('amountPrint', formattedAmount); // Display amount with 2 decimal places

        // Instantiate ToWords and convert
        // Ensure ToWords is defined in the global scope (as handled in ToWords.js)
        if (typeof ToWords !== 'undefined') {
            const toWords = new ToWords({
                localeCode: 'en-IN',
                converterOptions: {
                    currency: true,
                    ignoreDecimal: false
                }
            });
            const words = toWords.convert(amount);
            setElementText('amountWordsPrint', words);
        } else {
            console.error("ToWords library not loaded or not accessible.");
            setElementText('amountWordsPrint', 'Error: Converter not available');
        }
      } else {
        setElementText('amountPrint', '0.00');
        setElementText('amountWordsPrint', 'Invalid Amount');
      }

      // Populate Customer Acknowledgement Slip
      setElementText('senderBranchAck', urlParams.get('senderBranch') || 'N/A');
      setElementText('senderAccountAck', urlParams.get('senderAccount') || 'N/A');
      setElementText('transactionTypeAck', urlParams.get('transactionType') || 'N/A');
      setElementText('amountAck', isNaN(amount) ? '0.00' : amount.toLocaleString('en-IN', {minimumFractionDigits: 2,maximumFractionDigits: 2}));
      setElementText('beneficiaryAccountAck', urlParams.get('beneficiaryAccount') || 'N/A');
      setElementText('bankNameAck', urlParams.get('bankName') || 'N/A');
      setElementText('ifsCodeAck', urlParams.get('ifsCode') || 'N/A');
      setElementText('payeeNameAck', urlParams.get('payeeName') || 'N/A');

      // Set current date
      const today = new Date();
      const dd = String(today.getDate()).padStart(2, '0');
      const mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
      const yyyy = today.getFullYear(); // Corrected variable name
      setElementText('currentDate', `${dd}-${mm}-${yyyy}`);
    });

    // Function to export the page content as a PDF
    function exportPdf() {
        const element = document.querySelector('.container'); // Select the main content container
        const printButtons = document.querySelector('.print-buttons');

        // Temporarily hide the print buttons before capturing the content
        if (printButtons) {
            printButtons.style.display = 'none';
        }

        // Use html2canvas to render the HTML element as a canvas image
        // Increased scale for better resolution, set logging to false
        html2canvas(element, { scale: 3, useCORS: true, logging: false }).then(canvas => {
            const imgData = canvas.toDataURL('image/png'); // Get image data as PNG
            const { jsPDF } = window.jspdf; // Get jsPDF instance from global scope
            const pdf = new jsPDF('p', 'mm', 'a4'); // Initialize PDF (portrait, mm, A4 size)

            const A4_WIDTH_MM = 210;
            const A4_HEIGHT_MM = 297;
            const PDF_MARGIN_MM = 10; // Margin for the PDF content itself

            // Calculate usable area within PDF margins
            const usableWidth = A4_WIDTH_MM - (2 * PDF_MARGIN_MM);
            const usableHeight = A4_HEIGHT_MM - (2 * PDF_MARGIN_MM);

            // Calculate the aspect ratio of the captured image
            const imgAspectRatio = canvas.width / canvas.height;

            let finalImgWidth = usableWidth;
            let finalImgHeight = usableWidth / imgAspectRatio; // Scale height based on width

            // If the calculated height is greater than usableHeight, scale based on height instead
            if (finalImgHeight > usableHeight) {
                finalImgHeight = usableHeight;
                finalImgWidth = usableHeight * imgAspectRatio; // Scale width based on height
            }

            // Center the image on the page
            const xOffset = PDF_MARGIN_MM + (usableWidth - finalImgWidth) / 2;
            const yOffset = PDF_MARGIN_MM + (usableHeight - finalImgHeight) / 2;


            // Add the image to the PDF, scaled to fit one page
            pdf.addImage(imgData, 'PNG', xOffset, yOffset, finalImgWidth, finalImgHeight);

            pdf.save('RTGS_NEFT_Form.pdf'); // Save the generated PDF

            // Show the print buttons again after PDF generation
            if (printButtons) {
                printButtons.style.display = 'block';
            }
        }).catch(error => {
            console.error("Error generating PDF:", error);
            // Ensure buttons are re-shown even if there's an error
            if (printButtons) {
                printButtons.style.display = 'block';
            }
        });
    }
  </script>
</body>
</html>